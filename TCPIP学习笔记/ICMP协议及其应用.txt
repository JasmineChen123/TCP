第6，7，8章ICMP：Internet控制报文协议及其应用
1.引言 
ICMP是IP的一个组成部分，ICMP报文把差错报文返回给用户
给主机处理错误的机会，所以IP层的协议可以做到安全
ICMP报文在IP数据报内部传输
2.ICMP协议分为两类
查询报文：
  1.ping查询
  2.子网掩码查询：“无盘工作站”在初始化自身的时候初始化子网掩码
  3.时间戳查询：用来同步时间
差错报文：
ICMP端口不可达差错
注意：ICMP差错报文必须包括生成该差错报文的数据报IP首部
不同系统，对ICMP报文的处理方式是不同的
3.ICMP的应用——ping
（1）原理：利用ICMP协议包侦测另个主机是否可达
用类型码为0的ICMP请求，受到请求用8回应
ping程序计算间隔时间，以判断网络大致情况
（2）LAN 输出和WAN输出
LAN:局域网
WAN：广域网
广域网分组重复，失序，数据丢失，且往返时间变化大
（3）线路SLIP链接和拨号SLIP链接
拨号SLIP链接在链路的两端增加了调制解调器
（4）IP 记录路由选项（RR）
凡是处理过数据报的路由器，将IP地址放入字段中
但IP首部空间有限，9个IP地址
（5）异常输出
问题：ICMP回显请求直接从netb传到aix,而
回显应答从aix经过路由器gateway再到netb?
原因：当aix没有明确的某个目的主机的路由时，
将把数据发往默认项指定的路由器gateway
而路由器gateway有更强的选路能力

4.ICMP的应用——Traceroute
（1）Traceroute 功能
Traceroute程序可以让我们看到IP数据报从一台主机
传到另一台主机所经过的路由
TTL=time to live
（2）原理
    1.先发送一个TTL=1的UDP数据报
    经过第一个路由器，TTL=0,并发送一个“主机不可达”的
    ICMP
    2.主机收到后发送一个TTL=2的UDP数据报
    3.如此往返到达目的主机，获得IP路径
注意事项：
    1.连续两份IP数据报可能采用不同路由
    2.不能保证ICMP路由和traceroute发送的UDP数据报采用同一路由
（3）IP源站选路选项
    1.严格的源站路由选项
    发送端指明IP数据报必须使用的路由
    若源路由所指定的下一个路由器不在指定的网络上
    则返回“源站路由失败”的ICMP差错报文
    2.宽松的源站选路
    在信源和信宿之间可通过其它路由器
    选路不对称













